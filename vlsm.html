<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>LoonBac21 :: VLSM Calculator</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="Calculadora VLSM (Variable Length Subnet Mask) - Herramienta profesional para subneteo avanzado.">

<!-- FAVICON -->
<link rel="icon" type="image/png" href="ico.png">
<link rel="shortcut icon" type="image/png" href="ico.png">

<link rel="preload" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600;700&display=swap" as="style">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600;700&display=swap">
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="styles/vlsm.css">
</head>
<body>
<header class="top-bar">
  <div class="bar-inner">
    <span class="prompt">loonbac21@drix:~$ vlsm-calculator</span>
    <span class="blip" aria-hidden="true"></span>
  </div>
</header>

<main class="wrap">
  <!-- PANEL HEADER -->
  <section class="panel">
    <div class="vlsm-header">
      <div class="header-content">
        <div class="title-row">
          <h1 class="vlsm-title">
            <span class="accent">üåê VLSM Calculator</span>
          </h1>
          <div class="credits-badge">
            <span class="credits-text">Algoritmo por:</span>
            <a class="credits-link" href="https://github.com/Yokonad" target="_blank" rel="noopener noreferrer">
              <span class="github-icon">‚ö°</span>
              Yokonad
              <span class="external-icon">‚Üó</span>
            </a>
          </div>
        </div>
        <p class="mono vlsm-subtitle">Variable Length Subnet Mask - Subneteo Avanzado</p>
      </div>
      <a class="btn slim" href="index.html">‚Üê Volver</a>
    </div>
  </section>

  <!-- PANEL CALCULADORA -->
  <section class="panel">
    <div class="vlsm-tabs">
      <div class="tab-bar">
        <button class="tab active" data-tab="vlsm" id="vlsm-tab">VLSM Subnets</button>
        <button class="tab" data-tab="enlaces" id="enlaces-tab">Router Links</button>
        <div class="slider" id="tab-slider"></div>
      </div>
      
      <!-- TAB VLSM -->
      <div class="tab-content">
        <div class="tab-pane active" id="pane-vlsm">
          <div class="calc-grid">
            <div class="input-section">
              <h3 class="section-title accent">Par√°metros de Red</h3>
              
              <div class="input-group">
                <label class="input-label">Red Base:</label>
                <input type="text" id="vlsm-ip" placeholder="192.168.1.0" class="calc-input">
              </div>
              
              <div class="input-group">
                <label class="input-label">Prefijo Principal:</label>
                <input type="number" id="vlsm-prefix" placeholder="24" min="1" max="30" class="calc-input">
              </div>
              
              <div class="input-group">
                <label class="input-label">Hosts por Subred:</label>
                <div class="hosts-input-container">
                  <input type="text" id="vlsm-hosts" placeholder="100, 50, 25, 10" class="calc-input">
                  <small class="input-hint">Separados por comas (se ordenar√°n autom√°ticamente)</small>
                </div>
              </div>
              
              <div class="calc-actions">
                <button class="btn calc-btn" onclick="calcularVLSM()">
                  <span class="btn-icon">‚ö°</span>
                  Calcular VLSM
                </button>
                <button class="btn ghost" onclick="limpiarVLSM()">Limpiar</button>
              </div>
            </div>
            
            <div class="info-section">
              <h3 class="section-title accent">¬øQu√© es VLSM?</h3>
              <div class="info-content">
                <p class="mono info-text">
                  <strong>VLSM</strong> permite crear subredes de diferentes tama√±os dentro de una red principal, 
                  optimizando el uso de direcciones IP seg√∫n las necesidades espec√≠ficas.
                </p>
                <div class="info-benefits">
                  <h4 class="benefit-title">Ventajas:</h4>
                  <ul class="benefit-list">
                    <li>Uso eficiente del espacio IP</li>
                    <li>Reducci√≥n del desperdicio</li>
                    <li>Dise√±o de red flexible</li>
                    <li>Escalabilidad mejorada</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          
          <div id="vlsm-results" class="results-container"></div>
        </div>
        
        <!-- TAB ENLACES -->
        <div class="tab-pane" id="pane-enlaces">
          <div class="calc-grid">
            <div class="input-section">
              <h3 class="section-title accent">Enlaces Router-to-Router</h3>
              
              <div class="input-group">
                <label class="input-label">Red Base:</label>
                <input type="text" id="enlaces-ip" placeholder="10.0.0.0" class="calc-input">
              </div>
              
              <div class="input-group">
                <label class="input-label">Prefijo Principal:</label>
                <input type="number" id="enlaces-prefix" placeholder="16" min="1" max="30" class="calc-input">
              </div>
              
              <div class="input-group">
                <label class="input-label">N√∫mero de Enlaces:</label>
                <input type="number" id="enlaces-count" placeholder="5" min="1" max="100" class="calc-input">
                <small class="input-hint">Cada enlace usar√° una subred /30 (2 IPs √∫tiles)</small>
              </div>
              
              <div class="calc-actions">
                <button class="btn calc-btn" onclick="calcularEnlaces()">
                  <span class="btn-icon">üîó</span>
                  Calcular Enlaces
                </button>
                <button class="btn ghost" onclick="limpiarEnlaces()">Limpiar</button>
              </div>
            </div>
            
            <div class="info-section">
              <h3 class="section-title accent">Enlaces de Red</h3>
              <div class="info-content">
                <p class="mono info-text">
                  Los <strong>enlaces punto a punto</strong> entre routers usan subredes /30, 
                  proporcionando exactamente 2 IPs utilizables por enlace.
                </p>
                <div class="info-benefits">
                  <h4 class="benefit-title">Caracter√≠sticas /30:</h4>
                  <ul class="benefit-list">
                    <li>2 IPs utilizables por enlace</li>
                    <li>M√°scara: 255.255.255.252</li>
                    <li>Wildcard: 0.0.0.3</li>
                    <li>Ideal para enlaces WAN</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          
          <div id="enlaces-results" class="results-container"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- PANEL EJEMPLOS -->
  <section class="panel">
    <h2 class="panel-heading">Ejemplos Pr√°cticos</h2>
    
    <div class="examples-grid">
      <div class="example-card">
        <div class="example-header">
          <span class="example-icon">üè¢</span>
          <h3 class="example-title">Empresa Peque√±a</h3>
        </div>
        <div class="example-content">
          <p class="mono example-text">
            <strong>Red:</strong> 192.168.1.0/24<br>
            <strong>Departamentos:</strong><br>
            ‚Ä¢ IT: 30 hosts<br>
            ‚Ä¢ Ventas: 20 hosts<br>
            ‚Ä¢ Admin: 10 hosts<br>
            <strong>Resultado:</strong> 3 subredes optimizadas
          </p>
        </div>
      </div>
      
      <div class="example-card">
        <div class="example-header">
          <span class="example-icon">üè´</span>
          <h3 class="example-title">Campus Universitario</h3>
        </div>
        <div class="example-content">
          <p class="mono example-text">
            <strong>Red:</strong> 10.0.0.0/16<br>
            <strong>Edificios:</strong><br>
            ‚Ä¢ Edificio A: 500 hosts<br>
            ‚Ä¢ Edificio B: 300 hosts<br>
            ‚Ä¢ Edificio C: 100 hosts<br>
            <strong>Resultado:</strong> Subredes escalables
          </p>
        </div>
      </div>
      
      <div class="example-card">
        <div class="example-header">
          <span class="example-icon">üîó</span>
          <h3 class="example-title">Enlaces WAN</h3>
        </div>
        <div class="example-content">
          <p class="mono example-text">
            <strong>Red:</strong> 172.16.0.0/20<br>
            <strong>Enlaces:</strong><br>
            ‚Ä¢ Router A ‚Üî Router B<br>
            ‚Ä¢ Router B ‚Üî Router C<br>
            ‚Ä¢ Router C ‚Üî Router D<br>
            <strong>Resultado:</strong> 3 enlaces /30
          </p>
        </div>
      </div>
    </div>
  </section>
</main>

<footer class="foot">
  <p class="mono tiny">&copy; 2025 LoonBac21 ¬∑ VLSM Calculator Professional Tool</p>
</footer>

<script>
// ==================== FUNCIONES DE VALIDACI√ìN ====================
function validarIP(ip) {
    const ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
    return ipRegex.test(ip);
}

function validarPrefijo(prefijo) {
    return prefijo >= 1 && prefijo <= 30;
}

function calcularPrefijoDesdeHosts(numHosts) {
    return 32 - Math.ceil(Math.log2(numHosts + 2));
}

function calcularWildcard(mascara) {
    const partes = mascara.split('.').map(Number);
    return partes.map(parte => 255 - parte).join('.');
}

// ==================== FUNCIONES DE CONVERSI√ìN IP ====================
function ipToInt(ip) {
    const partes = ip.split('.').map(Number);
    return (partes[0] << 24) | (partes[1] << 16) | (partes[2] << 8) | partes[3];
}

function intToIP(int) {
    return [
        (int >>> 24) & 255,
        (int >>> 16) & 255,
        (int >>> 8) & 255,
        int & 255
    ].join('.');
}

function calcularMascara(prefijo) {
    const mask = (0xFFFFFFFF << (32 - prefijo)) >>> 0;
    return intToIP(mask);
}

// ==================== C√ÅLCULO VLSM ====================
function calcularVLSM() {
    const ipBase = document.getElementById('vlsm-ip').value.trim();
    const prefijoStr = document.getElementById('vlsm-prefix').value.trim();
    const hostsInput = document.getElementById('vlsm-hosts').value.trim();
    const resultsDiv = document.getElementById('vlsm-results');
    
    // Validaciones
    if (!ipBase || !prefijoStr || !hostsInput) {
        mostrarError(resultsDiv, '‚ö†Ô∏è Por favor completa todos los campos');
        return;
    }
    
    if (!validarIP(ipBase)) {
        mostrarError(resultsDiv, '‚ùå La direcci√≥n IP no es v√°lida');
        return;
    }
    
    const prefijoPrincipal = parseInt(prefijoStr);
    if (!validarPrefijo(prefijoPrincipal)) {
        mostrarError(resultsDiv, '‚ùå El prefijo debe estar entre 1 y 30');
        return;
    }
    
    const hosts = hostsInput.split(',')
        .map(h => parseInt(h.trim()))
        .filter(h => h > 0)
        .sort((a, b) => b - a);
    
    if (hosts.length === 0) {
        mostrarError(resultsDiv, '‚ùå Ingresa al menos una cantidad de hosts v√°lida');
        return;
    }
    
    try {
        const resultado = procesarVLSM(ipBase, prefijoPrincipal, hosts);
        if (typeof resultado === 'string') {
            mostrarError(resultsDiv, resultado);
        } else {
            mostrarResultadosVLSM(resultado, resultsDiv);
        }
    } catch (error) {
        mostrarError(resultsDiv, '‚ùå Error en el c√°lculo: ' + error.message);
    }
}

function procesarVLSM(ipBase, prefijoPrincipal, hosts) {
    const redPrincipalInt = ipToInt(ipBase) & (0xFFFFFFFF << (32 - prefijoPrincipal));
    const redPrincipal = intToIP(redPrincipalInt);
    const tamanoPrincipal = Math.pow(2, 32 - prefijoPrincipal);
    
    const subredes = [];
    let redActualInt = redPrincipalInt;
    
    for (let i = 0; i < hosts.length; i++) {
        const numHosts = hosts[i];
        const prefijo = calcularPrefijoDesdeHosts(numHosts);
        const tamanoSubred = Math.pow(2, 32 - prefijo);
        
        // Verificar que la subred cabe en la red principal
        if (redActualInt + tamanoSubred > redPrincipalInt + tamanoPrincipal) {
            return `‚ùå Error: No hay suficiente espacio para ${numHosts} hosts en la red ${redPrincipal}/${prefijoPrincipal}`;
        }
        
        const redSubred = intToIP(redActualInt);
        const mascara = calcularMascara(prefijo);
        const wildcard = calcularWildcard(mascara);
        const broadcast = intToIP(redActualInt + tamanoSubred - 1);
        const primerHost = intToIP(redActualInt + 1);
        const ultimoHost = intToIP(redActualInt + tamanoSubred - 2);
        const hostsDisponibles = tamanoSubred - 2;
        
        subredes.push({
            subred: `Subred ${i + 1}`,
            direccionRed: redSubred,
            mascara: mascara,
            wildcard: wildcard,
            prefijo: `/${prefijo}`,
            rangoHosts: `${primerHost} - ${ultimoHost}`,
            broadcast: broadcast,
            hostsNecesarios: numHosts,
            hostsDisponibles: hostsDisponibles
        });
        
        redActualInt += tamanoSubred;
    }
    
    return subredes;
}

// ==================== C√ÅLCULO ENLACES ====================
function calcularEnlaces() {
    const ipBase = document.getElementById('enlaces-ip').value.trim();
    const prefijoStr = document.getElementById('enlaces-prefix').value.trim();
    const enlacesStr = document.getElementById('enlaces-count').value.trim();
    const resultsDiv = document.getElementById('enlaces-results');
    
    // Validaciones
    if (!ipBase || !prefijoStr || !enlacesStr) {
        mostrarError(resultsDiv, '‚ö†Ô∏è Por favor completa todos los campos');
        return;
    }
    
    if (!validarIP(ipBase)) {
        mostrarError(resultsDiv, '‚ùå La direcci√≥n IP no es v√°lida');
        return;
    }
    
    const prefijoPrincipal = parseInt(prefijoStr);
    if (!validarPrefijo(prefijoPrincipal)) {
        mostrarError(resultsDiv, '‚ùå El prefijo debe estar entre 1 y 30');
        return;
    }
    
    const numEnlaces = parseInt(enlacesStr);
    if (numEnlaces < 1 || numEnlaces > 1000) {
        mostrarError(resultsDiv, '‚ùå El n√∫mero de enlaces debe estar entre 1 y 1000');
        return;
    }
    
    try {
        const resultado = procesarEnlaces(ipBase, prefijoPrincipal, numEnlaces);
        if (typeof resultado === 'string') {
            mostrarError(resultsDiv, resultado);
        } else {
            mostrarResultadosEnlaces(resultado, resultsDiv);
        }
    } catch (error) {
        mostrarError(resultsDiv, '‚ùå Error en el c√°lculo: ' + error.message);
    }
}

function procesarEnlaces(ipBase, prefijoPrincipal, numEnlaces) {
    const redPrincipalInt = ipToInt(ipBase) & (0xFFFFFFFF << (32 - prefijoPrincipal));
    const redPrincipal = intToIP(redPrincipalInt);
    const tamanoPrincipal = Math.pow(2, 32 - prefijoPrincipal);
    
    const enlaces = [];
    let redActualInt = redPrincipalInt;
    const tamanoEnlace = 4; // /30 = 4 IPs
    
    for (let i = 0; i < numEnlaces; i++) {
        // Verificar que el enlace cabe en la red principal
        if (redActualInt + tamanoEnlace > redPrincipalInt + tamanoPrincipal) {
            return `‚ùå Error: No hay suficiente espacio para ${numEnlaces} enlaces en la red ${redPrincipal}/${prefijoPrincipal}`;
        }
        
        const redEnlace = intToIP(redActualInt);
        const mascara = "255.255.255.252";
        const wildcard = "0.0.0.3";
        const broadcast = intToIP(redActualInt + 3);
        const ip1 = intToIP(redActualInt + 1);
        const ip2 = intToIP(redActualInt + 2);
        
        enlaces.push({
            enlace: `Enlace ${i + 1}`,
            direccionRed: redEnlace,
            mascara: mascara,
            wildcard: wildcard,
            prefijo: "/30",
            ipsUtilizables: `${ip1} - ${ip2}`,
            broadcast: broadcast
        });
        
        redActualInt += tamanoEnlace;
    }
    
    return enlaces;
}

// ==================== FUNCIONES DE INTERFAZ ====================
function mostrarError(container, mensaje) {
    container.innerHTML = `
        <div class="error-message">
            <span class="error-icon">‚ö†Ô∏è</span>
            <span class="error-text">${mensaje}</span>
        </div>
    `;
}

function mostrarResultadosVLSM(subredes, container) {
    let html = `
        <div class="results-header">
            <span class="results-icon">üìä</span>
            <h3 class="results-title">Resultados VLSM</h3>
            <span class="results-count">${subredes.length} subredes generadas</span>
        </div>
        <div class="results-grid">
    `;
    
    subredes.forEach((subred, index) => {
        html += `
            <div class="result-card vlsm-card">
                <div class="card-header">
                    <span class="card-number">${index + 1}</span>
                    <h4 class="card-title">${subred.subred}</h4>
                    <span class="card-badge">${subred.hostsNecesarios} hosts</span>
                </div>
                <div class="card-content">
                    <div class="result-row">
                        <span class="result-label">Red:</span>
                        <span class="result-value network">${subred.direccionRed}${subred.prefijo}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">M√°scara:</span>
                        <span class="result-value">${subred.mascara}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Wildcard:</span>
                        <span class="result-value">${subred.wildcard}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Hosts:</span>
                        <span class="result-value range">${subred.rangoHosts}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Broadcast:</span>
                        <span class="result-value broadcast">${subred.broadcast}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Disponibles:</span>
                        <span class="result-value available">${subred.hostsDisponibles} hosts</span>
                    </div>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function mostrarResultadosEnlaces(enlaces, container) {
    let html = `
        <div class="results-header">
            <span class="results-icon">üîó</span>
            <h3 class="results-title">Enlaces de Router</h3>
            <span class="results-count">${enlaces.length} enlaces generados</span>
        </div>
        <div class="results-grid">
    `;
    
    enlaces.forEach((enlace, index) => {
        html += `
            <div class="result-card enlace-card">
                <div class="card-header">
                    <span class="card-number">${index + 1}</span>
                    <h4 class="card-title">${enlace.enlace}</h4>
                    <span class="card-badge">/30</span>
                </div>
                <div class="card-content">
                    <div class="result-row">
                        <span class="result-label">Red:</span>
                        <span class="result-value network">${enlace.direccionRed}${enlace.prefijo}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">M√°scara:</span>
                        <span class="result-value">${enlace.mascara}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Wildcard:</span>
                        <span class="result-value">${enlace.wildcard}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">IPs √∫tiles:</span>
                        <span class="result-value range">${enlace.ipsUtilizables}</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Broadcast:</span>
                        <span class="result-value broadcast">${enlace.broadcast}</span>
                    </div>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function limpiarVLSM() {
    document.getElementById('vlsm-ip').value = '';
    document.getElementById('vlsm-prefix').value = '';
    document.getElementById('vlsm-hosts').value = '';
    document.getElementById('vlsm-results').innerHTML = '';
}

function limpiarEnlaces() {
    document.getElementById('enlaces-ip').value = '';
    document.getElementById('enlaces-prefix').value = '';
    document.getElementById('enlaces-count').value = '';
    document.getElementById('enlaces-results').innerHTML = '';
}

// ==================== SISTEMA DE TABS ====================
function initTabs() {
    const tabs = document.querySelectorAll('.tab');
    const panes = document.querySelectorAll('.tab-pane');
    const slider = document.getElementById('tab-slider');
    
    tabs.forEach((tab, index) => {
        tab.addEventListener('click', () => {
            // Remover active de todos
            tabs.forEach(t => t.classList.remove('active'));
            panes.forEach(p => p.classList.remove('active'));
            
            // Activar el clickeado
            tab.classList.add('active');
            const targetPane = document.getElementById(`pane-${tab.dataset.tab}`);
            if (targetPane) {
                targetPane.classList.add('active');
            }
            
            // Mover slider
            slider.style.left = `${index * 50}%`;
        });
    });
}

// ==================== INICIALIZACI√ìN ====================
document.addEventListener('DOMContentLoaded', function() {
    initTabs();
    
    // Ejemplos r√°pidos
    document.getElementById('vlsm-ip').addEventListener('focus', function() {
        if (!this.value) {
            this.value = '192.168.1.0';
        }
    });
    
    document.getElementById('vlsm-prefix').addEventListener('focus', function() {
        if (!this.value) {
            this.value = '24';
        }
    });
    
    document.getElementById('vlsm-hosts').addEventListener('focus', function() {
        if (!this.value) {
            this.value = '100, 50, 25, 10';
        }
    });
    
    document.getElementById('enlaces-ip').addEventListener('focus', function() {
        if (!this.value) {
            this.value = '10.0.0.0';
        }
    });
    
    document.getElementById('enlaces-prefix').addEventListener('focus', function() {
        if (!this.value) {
            this.value = '16';
        }
    });
    
    document.getElementById('enlaces-count').addEventListener('focus', function() {
        if (!this.value) {
            this.value = '5';
        }
    });
});
</script>
</body>
</html>
